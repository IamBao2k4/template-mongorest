{
  "_id": "67f8f25036ac50fe5604e803",
  "title": "is-user-owner-or-manager-of-group",
  "note": "Kiểm tra xem người dùng có phải là owner hoặc manager của nhóm hay không. Chỉ owner và manager mới có quyền quản lý nhóm.",
  "entity": "mge-group-member",
  "advance": "[\\r\\n  {\\r\\n    \\\"$match\\\": {\\r\\n      \\\"user\\\": \\\"@jwt:user.id\\\",\\r\\n      \\\"status\\\": \\\"joined\\\",\\r\\n      \\\"$or\\\": [\\r\\n        {\\r\\n          \\\"social_group\\\": \\\"@param:group_id\\\"\\r\\n        },\\r\\n        {\\r\\n          \\\"social_group\\\": \\\"@body:social_group\\\"\\r\\n        }\\r\\n      ],\\r\\n      \\\"role\\\": {\\r\\n        \\\"$in\\\": [\\\"owner\\\", \\\"manager\\\"]\\r\\n      }\\r\\n    }\\r\\n  },\\r\\n  {\\r\\n    \\\"$addFields\\\": {\\r\\n      \\\"social_group_as_objectId\\\": {\\r\\n        \\\"$map\\\": {\\r\\n          \\\"input\\\": \\\"$social_group\\\",\\r\\n          \\\"as\\\": \\\"sg\\\",\\r\\n          \\\"in\\\": {\\r\\n            \\\"$toObjectId\\\": \\\"$$sg\\\"\\r\\n          }\\r\\n        }\\r\\n      }\\r\\n    }\\r\\n  },\\r\\n  {\\r\\n    \\\"$lookup\\\": {\\r\\n      \\\"from\\\": \\\"mge-group\\\",\\r\\n      \\\"localField\\\": \\\"social_group_as_objectId\\\",\\r\\n      \\\"foreignField\\\": \\\"_id\\\",\\r\\n      \\\"as\\\": \\\"group_data\\\",\\r\\n      \\\"pipeline\\\": [\\r\\n        {\\r\\n          \\\"$match\\\": {\\r\\n            \\\"status\\\": \\\"active\\\"\\r\\n          }\\r\\n        }\\r\\n      ]\\r\\n    }\\r\\n  },\\r\\n  {\\r\\n    \\\"$match\\\": {\\r\\n      \\\"group_data\\\": {\\r\\n        \\\"$ne\\\": []\\r\\n      }\\r\\n    }\\r\\n  },\\r\\n  {\\r\\n    \\\"$project\\\": {\\r\\n      \\\"_id\\\": 1,\\r\\n      \\\"user\\\": 1,\\r\\n      \\\"social_group\\\": 1,\\r\\n      \\\"status\\\": 1,\\r\\n      \\\"role\\\": 1,\\r\\n      \\\"is_admin\\\": true\\r\\n    }\\r\\n  }\\r\\n]",
  "tenant_id": "674028d2611a654e763a73e8"
}