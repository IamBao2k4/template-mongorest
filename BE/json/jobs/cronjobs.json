[
  {
    "_id": "6819747515cf915ba520b0f7",
    "title": "tiennt test - 674028d2611a654e763a73e8",
    "cron_expression": "*/1 * * * *",
    "is_active": true,
    "data": {
      "_id": "6819747515cf915ba520b0f7",
      "title": "tiennt test",
      "setup": [
        {
          "merge": "  {\n    \"$merge\": {\n      \"into\": \"mge-tweet-social-file\",\n      \"on\": \"_id\",\n      \"whenMatched\": \"merge\",\n      \"whenNotMatched\": \"discard\"\n    }\n  }"
        },
        {
          "merge": "  {\n    \"$merge\": {\n      \"into\": \"mge-tweet-social-news\",\n      \"on\": \"_id\",\n      \"whenMatched\": \"merge\",\n      \"whenNotMatched\": \"discard\"\n    }\n  }"
        },
        {
          "merge": "  {\n    \"$merge\": {\n      \"into\": \"mge-tweet-social-votes\",\n      \"on\": \"_id\",\n     \"whenMatched\": \"merge\",\n      \"whenNotMatched\": \"discard\"\n    }\n  }"
        },
        {
          "merge": "  {\n    \"$merge\": {\n      \"into\": \"mge-tweet-social-videos\",\n      \"on\": \"_id\",\n      \"whenMatched\": \"merge\",\n      \"whenNotMatched\": \"discard\"\n    }\n  }"
        },
        {
          "merge": "  {\n    \"$merge\": {\n      \"into\": \"mge-tweet-social-image\",\n      \"on\": \"_id\",\n      \"whenMatched\": \"merge\",\n      \"whenNotMatched\": \"discard\"\n    }\n  }"
        }
      ],
      "created_at": "2025-05-06T09:31:17.000Z",
      "created_by": "6711e8a47b45b2974bd6133c",
      "updated_at": "2025-05-08T10:00:44.000Z",
      "updated_by": "6711e8a47b45b2974bd6133c",
      "tenant_id": "674028d2611a654e763a73e8",
      "timeout": "*/1 * * * *",
      "arrgregate": "[\n  {\n    \"$match\": {\n      \"status\": \"waiting\",\n      \"tweet_waiting_time\": {\n        \"$exists\": true\n      }\n    }\n  },\n  {\n    \"$addFields\": {\n      \"tweet_waiting_time\": {\n        \"$toDate\": \"$tweet_waiting_time\"\n      },\n      \"server_time_g7\": {\n        \"$dateAdd\": {\n          \"startDate\": \"$$NOW\",\n          \"unit\": \"hour\",\n          \"amount\": 7\n        }\n      }\n    }\n  },\n  {\n    \"$match\": {\n      \"$expr\": {\n        \"$lte\": [\n          \"$tweet_waiting_time\",\n          \"$server_time_g7\"\n        ]\n      }\n    }\n  },\n  {\n    \"$set\": {\n      \"status\": [\n        \"active\"\n      ]\n    }\n  }\n]",
      "collection_name": "mge-tweet",
      "type": [
        "classic"
      ],
      "flow": null,
      "locale": null,
      "locale_id": null
    }
  },
  {
    "_id": "681c8711a536a4837dd289d5",
    "title": "test flow - 674028d2611a654e763a73e8",
    "cron_expression": "0 0 2 * * *",
    "is_active": true,
    "data": {
      "_id": "681c8711a536a4837dd289d5",
      "title": "test flow",
      "type": [
        "flow"
      ],
      "timeout": "0 0 2 * * *",
      "arrgregate": null,
      "collection_name": null,
      "setup": null,
      "flow": "[\n  {\n    \"type\": \"email\",\n    \"query_get_users\": [],\n    \"collection_name\": \"abc\",\n    \"template\": \"<p>Hi ${{username}}</p>\"\n  },\n  {\n    \"type\": \"notification\",\n    \"query_get_users\": [],\n    \"collection_name\": \"abc\",\n    \"template\": \"User ${{username}} like your post ${{post.title}}\",\n    \"link\": [\n      {\n        \"key\": \"${{user.username}}\",\n        \"object\": \"user|member|instructor\",\n        \"id\": \"user._id\"\n      },\n      {\n        \"key\": \"${{post.title}}\",\n        \"object\": \"user|member|instructor\",\n        \"id\": \"post._id\"\n      }\n    ]\n  },\n  {\n    \"type\": \"mongodb\",\n    \"action\": \"create|update|delete\",\n    \"query\": [],\n    \"collection_name_for_query\": \"abc\",\n    \"collection_name_for_action\": \"xyz\"\n  },\n  {\n    \"type\": \"redis\",\n    \"lua_script\": [],\n    \"key\": \"abc\"\n  }\n]",
      "locale": null,
      "locale_id": null,
      "created_at": "2025-05-08T17:27:29.000Z",
      "created_by": "6711e8a47b45b2974bd6133c",
      "updated_at": "2025-05-13T09:14:25.000Z",
      "updated_by": "6711e8a47b45b2974bd6133c",
      "tenant_id": "674028d2611a654e763a73e8",
      "watcher": "{\n  \"resource\": \"mongodb_collection|redis_key\",\n  \"object_name\": \"collection_name|key_name\",\n  \"lua_script\": \"find_or_check_key_value_with condition\",\n  \"query_mongo\": \"find_or_check_data_with condition\"\n}",
      "id": "681c8711a536a4837dd289d5"
    }
  },
  {
    "_id": "6822f28f87dcae27865d220f",
    "title": "Tenant Course Statistic by Day - 677f6b3da3131eb0d3f9906d",
    "cron_expression": "0 15 * * *",
    "is_active": true,
    "data": {
      "_id": "6822f28f87dcae27865d220f",
      "title": "Tenant Course Statistic by Day",
      "type": [
        "classic"
      ],
      "timeout": "0 15 * * *",
      "flow": null,
      "arrgregate": "[\n  {\n    \"$addFields\": {\n      \"tenant_id\": {\n        \"$toString\": \"$_id\"\n      }\n    }\n  },\n  {\n    \"$match\": {\n      \"tenant_id\": \"677f6b3da3131eb0d3f9906d\"\n    }\n  },\n  {\n    \"$lookup\": {\n      \"from\": \"mge-courses\",\n      \"let\": {\n        \"tenantId\": \"$tenant_id\"\n      },\n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$expr\": {\n              \"$and\": [\n                {\n                  \"$eq\": [\n                    \"$tenant_id\",\n                    \"$$tenantId\"\n                  ]\n                },\n                {\n                  \"$eq\": [\n                    {\n                      \"$dateTrunc\": {\n                        \"date\": \"$created_at\",\n                        \"unit\": \"day\"\n                      }\n                    },\n                    {\n                      \"$dateTrunc\": {\n                        \"date\": \"$$NOW\",\n                        \"unit\": \"day\"\n                      }\n                    }\n                  ]\n                }\n              ]\n            }\n          }\n        }\n      ],\n      \"as\": \"total_course\"\n    }\n  },\n  {\n    \"$addFields\": {\n      \"total_course\": {\n        \"$size\": \"$total_course\"\n      }\n    }\n  },\n  {\n    \"$lookup\": {\n      \"from\": \"mge-courses\",\n      \"let\": {\n        \"tenantId\": \"$tenant_id\"\n      },\n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$expr\": {\n              \"$and\": [\n                {\n                  \"$eq\": [\n                    \"$tenant_id\",\n                    \"$$tenantId\"\n                  ]\n                },\n                {\n                  \"$eq\": [\n                    \"$status\",\n                    \"active\"\n                  ]\n                },\n                {\n                  \"$eq\": [\n                    {\n                      \"$dateTrunc\": {\n                        \"date\": \"$created_at\",\n                        \"unit\": \"day\"\n                      }\n                    },\n                    {\n                      \"$dateTrunc\": {\n                        \"date\": \"$$NOW\",\n                        \"unit\": \"day\"\n                      }\n                    }\n                  ]\n                }\n              ]\n            }\n          }\n        }\n      ],\n      \"as\": \"total_course_active\"\n    }\n  },\n  {\n    \"$addFields\": {\n      \"total_course_active\": {\n        \"$size\": \"$total_course_active\"\n      }\n    }\n  },\n  {\n    \"$lookup\": {\n      \"from\": \"mge-courses\",\n      \"let\": {\n        \"tenantId\": \"$tenant_id\"\n      },\n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$expr\": {\n              \"$and\": [\n                {\n                  \"$eq\": [\n                    \"$tenant_id\",\n                    \"$$tenantId\"\n                  ]\n                },\n                {\n                  \"$eq\": [\n                    \"$status\",\n                    \"inactive\"\n                  ]\n                },\n                {\n                  \"$eq\": [\n                    {\n                      \"$dateTrunc\": {\n                        \"date\": \"$created_at\",\n                        \"unit\": \"day\"\n                      }\n                    },\n                    {\n                      \"$dateTrunc\": {\n                        \"date\": \"$$NOW\",\n                        \"unit\": \"day\"\n                      }\n                    }\n                  ]\n                }\n              ]\n            }\n          }\n        }\n      ],\n      \"as\": \"total_course_inactive\"\n    }\n  },\n  {\n    \"$addFields\": {\n      \"total_course_inactive\": {\n        \"$size\": \"$total_course_inactive\"\n      }\n    }\n  },\n  {\n    \"$lookup\": {\n      \"from\": \"user-tenant-profile\",\n      \"let\": {\n        \"tenantId\": \"$tenant_id\"\n      },\n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$expr\": {\n              \"$and\": [\n                {\n                  \"$eq\": [\n                    \"$tenant_id\",\n                    \"$$tenantId\"\n                  ]\n                },\n                {\n                  \"$eq\": [\n                    {\n                      \"$dateTrunc\": {\n                        \"date\": \"$created_at\",\n                        \"unit\": \"day\"\n                      }\n                    },\n                    {\n                      \"$dateTrunc\": {\n                        \"date\": \"$$NOW\",\n                        \"unit\": \"day\"\n                      }\n                    }\n                  ]\n                }\n              ]\n            }\n          }\n        }\n      ],\n      \"as\": \"total_tenant_user\"\n    }\n  },\n  {\n    \"$addFields\": {\n      \"total_tenant_user\": {\n        \"$size\": \"$total_tenant_user\"\n      }\n    }\n  },\n  {\n    \"$lookup\": {\n      \"from\": \"mge-user-learning-path\",\n      \"let\": {\n        \"tenantId\": \"$tenant_id\"\n      },\n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$expr\": {\n              \"$and\": [\n                {\n                  \"$eq\": [\n                    \"$tenant_id\",\n                    \"$$tenantId\"\n                  ]\n                },\n                {\n                  \"$eq\": [\n                    {\n                      \"$dateTrunc\": {\n                        \"date\": \"$created_at\",\n                        \"unit\": \"day\"\n                      }\n                    },\n                    {\n                      \"$dateTrunc\": {\n                        \"date\": \"$$NOW\",\n                        \"unit\": \"day\"\n                      }\n                    }\n                  ]\n                }\n              ]\n            }\n          }\n        }\n      ],\n      \"as\": \"total_learning_path\"\n    }\n  },\n  {\n    \"$addFields\": {\n      \"total_learning_path\": {\n        \"$size\": \"$total_learning_path\"\n      }\n    }\n  },\n  {\n    \"$addFields\": {\n      \"time_stamp\": {\n        \"$dateAdd\": {\n          \"startDate\": \"$$NOW\",\n          \"unit\": \"hour\",\n          \"amount\": 7\n        }\n      }\n    }\n  },\n  {\n    \"$project\": {\n      \"_id\": 0,\n      \"total_course\": 1,\n      \"total_course_active\": 1,\n      \"total_course_inactive\": 1,\n      \"total_tenant_user\": 1,\n      \"total_learning_path\": 1,\n      \"time_stamp\": 1,\n      \"tenant_id\": 1\n    }\n  }\n]",
      "collection_name": "tenant",
      "setup": [
        {
          "merge": "   {\n    \"$merge\": {\n      \"into\": \"mge-course-tenant-statistic\",\n      \"whenMatched\": \"merge\",\n      \"whenNotMatched\": \"insert\"\n    }\n  }"
        }
      ],
      "locale": null,
      "locale_id": null,
      "created_at": "2025-05-13T14:19:43.000Z",
      "created_by": "6711e8a47b45b2974bd6133c",
      "updated_at": "2025-05-26T11:46:51.000Z",
      "updated_by": "6711e8a47b45b2974bd6133c",
      "tenant_id": "677f6b3da3131eb0d3f9906d",
      "id": "6822f28f87dcae27865d220f"
    }
  },
  {
    "_id": "6822ff2687dcae27865d2756",
    "title": "Course Statistic by Day - 677f6b3da3131eb0d3f9906d",
    "cron_expression": "0 15 * * *",
    "is_active": true,
    "data": {
      "_id": "6822ff2687dcae27865d2756",
      "title": "Course Statistic by Day",
      "type": [
        "classic"
      ],
      "timeout": "0 15 * * *",
      "flow": null,
      "arrgregate": "[\n  {\n    \"$addFields\": {\n      \"course\": {\n        \"$toString\": \"$_id\"\n      }\n    }\n  },\n  {\n    \"$match\": {\n      \"tenant_id\": \"677f6b3da3131eb0d3f9906d\",\n      \"status\": \"active\"\n    }\n  },\n  {\n    \"$lookup\": {\n      \"from\": \"mge-lessons\",\n      \"let\": {\n        \"courseId\": [\n          \"$course\"\n        ]\n      },\n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$expr\": {\n              \"$and\": [\n                {\n                  \"$eq\": [\n                    \"$course\",\n                    \"$$courseId\"\n                  ]\n                },\n                {\n                  \"$eq\": [\n                    \"$status\",\n                    [\n                      \"active\"\n                    ]\n                  ]\n                },\n                {\n                  \"$eq\": [\n                    {\n                      \"$dateTrunc\": {\n                        \"date\": \"$created_at\",\n                        \"unit\": \"day\"\n                      }\n                    },\n                    {\n                      \"$dateTrunc\": {\n                        \"date\": \"$$NOW\",\n                        \"unit\": \"day\"\n                      }\n                    }\n                  ]\n                }\n              ]\n            }\n          }\n        }\n      ],\n      \"as\": \"total_lessons\"\n    }\n  },\n  {\n    \"$addFields\": {\n      \"total_lessons\": {\n        \"$size\": \"$total_lessons\"\n      }\n    }\n  },\n  {\n    \"$lookup\": {\n      \"from\": \"mge-course-member\",\n      \"let\": {\n        \"courseId\": [\n          \"$course\"\n        ]\n      },\n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$expr\": {\n              \"$and\": [\n                {\n                  \"$eq\": [\n                    \"$course\",\n                    \"$$courseId\"\n                  ]\n                },\n                {\n                  \"$eq\": [\n                    \"$status\",\n                    \"joined\"\n                  ]\n                },\n                {\n                  \"$eq\": [\n                    {\n                      \"$dateTrunc\": {\n                        \"date\": \"$created_at\",\n                        \"unit\": \"day\"\n                      }\n                    },\n                    {\n                      \"$dateTrunc\": {\n                        \"date\": \"$$NOW\",\n                        \"unit\": \"day\"\n                      }\n                    }\n                  ]\n                }\n              ]\n            }\n          }\n        }\n      ],\n      \"as\": \"total_members_1\"\n    }\n  },\n  {\n    \"$addFields\": {\n      \"total_members_1\": {\n        \"$size\": \"$total_members_1\"\n      }\n    }\n  },\n  {\n    \"$lookup\": {\n      \"from\": \"mge-course-log-record\",\n      \"let\": {\n        \"courseId\": [\n          \"$course\"\n        ]\n      },\n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$expr\": {\n              \"$and\": [\n                {\n                  \"$eq\": [\n                    \"$course\",\n                    \"$$courseId\"\n                  ]\n                },\n                {\n                  \"$eq\": [\n                    \"$type\",\n                    [\n                      \"course_invitation_approved\"\n                    ]\n                  ]\n                },\n                {\n                  \"$eq\": [\n                    {\n                      \"$dateTrunc\": {\n                        \"date\": \"$created_at\",\n                        \"unit\": \"day\"\n                      }\n                    },\n                    {\n                      \"$dateTrunc\": {\n                        \"date\": \"$$NOW\",\n                        \"unit\": \"day\"\n                      }\n                    }\n                  ]\n                }\n              ]\n            }\n          }\n        }\n      ],\n      \"as\": \"total_members_2\"\n    }\n  },\n  {\n    \"$addFields\": {\n      \"total_members_2\": {\n        \"$size\": \"$total_members_2\"\n      }\n    }\n  },\n  {\n    \"$addFields\": {\n      \"total_members\": {\n        \"$add\": [\n          \"$total_members_1\",\n          \"$total_members_2\"\n        ]\n      }\n    }\n  },\n  {\n    \"$lookup\": {\n      \"from\": \"mge-course-log-record\",\n      \"let\": {\n        \"courseId\": [\n          \"$course\"\n        ]\n      },\n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$expr\": {\n              \"$and\": [\n                {\n                  \"$eq\": [\n                    \"$course\",\n                    \"$$courseId\"\n                  ]\n                },\n                {\n                  \"$eq\": [\n                    \"$type\",\n                    [\n                      \"course_completed\"\n                    ]\n                  ]\n                },\n                {\n                  \"$eq\": [\n                    {\n                      \"$dateTrunc\": {\n                        \"date\": \"$created_at\",\n                        \"unit\": \"day\"\n                      }\n                    },\n                    {\n                      \"$dateTrunc\": {\n                        \"date\": \"$$NOW\",\n                        \"unit\": \"day\"\n                      }\n                    }\n                  ]\n                }\n              ]\n            }\n          }\n        }\n      ],\n      \"as\": \"completed_members\"\n    }\n  },\n  {\n    \"$addFields\": {\n      \"completed_members\": {\n        \"$size\": \"$completed_members\"\n      }\n    }\n  },\n  {\n    \"$lookup\": {\n      \"from\": \"mge-discussions\",\n      \"let\": {\n        \"courseId\": [\n          \"$course\"\n        ]\n      },\n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$expr\": {\n              \"$and\": [\n                {\n                  \"$eq\": [\n                    \"$course\",\n                    \"$$courseId\"\n                  ]\n                },\n                {\n                  \"$eq\": [\n                    {\n                      \"$dateTrunc\": {\n                        \"date\": \"$created_at\",\n                        \"unit\": \"day\"\n                      }\n                    },\n                    {\n                      \"$dateTrunc\": {\n                        \"date\": \"$$NOW\",\n                        \"unit\": \"day\"\n                      }\n                    }\n                  ]\n                }\n              ]\n            }\n          }\n        }\n      ],\n      \"as\": \"total_discussions\"\n    }\n  },\n  {\n    \"$addFields\": {\n      \"total_discussions\": {\n        \"$size\": \"$total_discussions\"\n      }\n    }\n  },\n  {\n    \"$lookup\": {\n      \"from\": \"mge-discussion-comment\",\n      \"let\": {\n        \"tenantId\": \"$tenant_id\",\n        \"courseId\": [\n          \"$course\"\n        ]\n      },\n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$expr\": {\n              \"$and\": [\n                {\n                  \"$eq\": [\n                    \"$tenant_id\",\n                    \"$$tenantId\"\n                  ]\n                },\n                {\n                  \"$eq\": [\n                    {\n                      \"$dateTrunc\": {\n                        \"date\": \"$created_at\",\n                        \"unit\": \"day\"\n                      }\n                    },\n                    {\n                      \"$dateTrunc\": {\n                        \"date\": \"$$NOW\",\n                        \"unit\": \"day\"\n                      }\n                    }\n                  ]\n                }\n              ]\n            }\n          }\n        },\n        {\n          \"$lookup\": {\n            \"from\": \"mge-discussions\",\n            \"let\": {\n              \"courseId\": \"$$courseId\",\n              \"discussionId\": \"$discussion\"\n            },\n            \"pipeline\": [\n              {\n                \"$addFields\": {\n                  \"_id\": {\n                    \"$toString\": \"$_id\"\n                  }\n                }\n              },\n              {\n                \"$match\": {\n                  \"$expr\": {\n                    \"$and\": [\n                      {\n                        \"$eq\": [\n                          [\n                            \"$_id\"\n                          ],\n                          \"$$discussionId\"\n                        ]\n                      },\n                      {\n                        \"$eq\": [\n                          \"$course\",\n                          \"$$courseId\"\n                        ]\n                      }\n                    ]\n                  }\n                }\n              }\n            ],\n            \"as\": \"is_course_discussion\"\n          }\n        },\n        {\n          \"$match\": {\n            \"is_course_discussion\": {\n              \"$ne\": []\n            }\n          }\n        }\n      ],\n      \"as\": \"total_comments\"\n    }\n  },\n  {\n    \"$addFields\": {\n      \"total_comments\": {\n        \"$size\": \"$total_comments\"\n      }\n    }\n  },\n  {\n    \"$lookup\": {\n      \"from\": \"mge-discussion-like\",\n      \"let\": {\n        \"courseId\": [\n          \"$course\"\n        ],\n        \"tenantId\": \"$tenant_id\"\n      },\n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$expr\": {\n              \"$and\": [\n                {\n                  \"$eq\": [\n                    \"$tenant_id\",\n                    \"$$tenantId\"\n                  ]\n                },\n                {\n                  \"$eq\": [\n                    {\n                      \"$dateTrunc\": {\n                        \"date\": \"$created_at\",\n                        \"unit\": \"day\"\n                      }\n                    },\n                    {\n                      \"$dateTrunc\": {\n                        \"date\": \"$$NOW\",\n                        \"unit\": \"day\"\n                      }\n                    }\n                  ]\n                }\n              ]\n            }\n          }\n        },\n        {\n          \"$lookup\": {\n            \"from\": \"mge-discussions\",\n            \"let\": {\n              \"courseId\": \"$$courseId\",\n              \"discussionId\": \"$discussion\"\n            },\n            \"pipeline\": [\n              {\n                \"$addFields\": {\n                  \"_id\": {\n                    \"$toString\": \"$_id\"\n                  }\n                }\n              },\n              {\n                \"$match\": {\n                  \"$expr\": {\n                    \"$and\": [\n                      {\n                        \"$in\": [\n                          \"$_id\",\n                          \"$$discussionId\"\n                        ]\n                      },\n                      {\n                        \"$eq\": [\n                          \"$course\",\n                          \"$$courseId\"\n                        ]\n                      }\n                    ]\n                  }\n                }\n              }\n            ],\n            \"as\": \"is_course_discussion\"\n          }\n        },\n        {\n          \"$match\": {\n            \"is_course_discussion\": {\n              \"$ne\": []\n            }\n          }\n        }\n      ],\n      \"as\": \"discussion_like_created\"\n    }\n  },\n  {\n    \"$addFields\": {\n      \"discussion_like_created\": {\n        \"$size\": \"$discussion_like_created\"\n      }\n    }\n  },\n  {\n    \"$lookup\": {\n      \"from\": \"mge-discussion-comment-like\",\n      \"let\": {\n        \"courseId\": [\n          \"$course\"\n        ],\n        \"tenantId\": \"$tenant_id\"\n      },\n      \"pipeline\": [\n        {\n          \"$match\": {\n            \"$expr\": {\n              \"$and\": [\n                {\n                  \"$eq\": [\n                    \"$tenant_id\",\n                    \"$$tenantId\"\n                  ]\n                },\n                {\n                  \"$eq\": [\n                    {\n                      \"$dateTrunc\": {\n                        \"date\": \"$created_at\",\n                        \"unit\": \"day\"\n                      }\n                    },\n                    {\n                      \"$dateTrunc\": {\n                        \"date\": \"$$NOW\",\n                        \"unit\": \"day\"\n                      }\n                    }\n                  ]\n                }\n              ]\n            }\n          }\n        },\n        {\n          \"$lookup\": {\n            \"from\": \"mge-discussion-comment\",\n            \"let\": {\n              \"courseId\": \"$$courseId\",\n              \"commentId\": \"$comment\"\n            },\n            \"pipeline\": [\n              {\n                \"$addFields\": {\n                  \"_id\": {\n                    \"$toString\": \"$_id\"\n                  }\n                }\n              },\n              {\n                \"$match\": {\n                  \"$expr\": {\n                    \"$and\": [\n                      {\n                        \"$eq\": [\n                          [\n                            \"$_id\"\n                          ],\n                          \"$$commentId\"\n                        ]\n                      }\n                    ]\n                  }\n                }\n              },\n              {\n                \"$lookup\": {\n                  \"from\": \"mge-discussions\",\n                  \"let\": {\n                    \"courseId\": \"$$courseId\",\n                    \"discussionId\": \"$discussion\"\n                  },\n                  \"pipeline\": [\n                    {\n                      \"$addFields\": {\n                        \"_id\": {\n                          \"$toString\": \"$_id\"\n                        }\n                      }\n                    },\n                    {\n                      \"$match\": {\n                        \"$expr\": {\n                          \"$and\": [\n                            {\n                              \"$eq\": [\n                                [\n                                  \"$_id\"\n                                ],\n                                \"$$discussionId\"\n                              ]\n                            },\n                            {\n                              \"$eq\": [\n                                \"$course\",\n                                \"$$courseId\"\n                              ]\n                            }\n                          ]\n                        }\n                      }\n                    }\n                  ],\n                  \"as\": \"is_course_discussion\"\n                }\n              },\n              {\n                \"$match\": {\n                  \"is_course_discussion\": {\n                    \"$ne\": []\n                  }\n                }\n              }\n            ],\n            \"as\": \"is_comment_discussion\"\n          }\n        },\n        {\n          \"$match\": {\n            \"is_comment_discussion\": {\n              \"$ne\": []\n            }\n          }\n        }\n      ],\n      \"as\": \"discussion_comment_like_created\"\n    }\n  },\n  {\n    \"$addFields\": {\n      \"discussion_comment_like_created\": {\n        \"$size\": \"$discussion_comment_like_created\"\n      }\n    }\n  },\n  {\n    \"$addFields\": {\n      \"total_likes\": {\n        \"$add\": [\n          \"$discussion_like_created\",\n          \"$discussion_comment_like_created\"\n        ]\n      }\n    }\n  },\n  {\n    \"$addFields\": {\n      \"time_stamp\": {\n        \"$dateAdd\": {\n          \"startDate\": \"$$NOW\",\n          \"unit\": \"hour\",\n          \"amount\": 7\n        }\n      }\n    }\n  },\n  {\n    \"$project\": {\n      \"_id\": 0,\n      \"total_lessons\": 1,\n      \"total_members\": 1,\n      \"total_discussions\": 1,\n      \"total_comments\": 1,\n      \"total_likes\": 1,\n      \"course\": 1,\n      \"time_stamp\": 1,\n      \"tenant_id\": 1,\n      \"completed_members\":1\n    }\n  }\n]",
      "collection_name": "mge-courses",
      "setup": [
        {
          "merge": "   {\n    \"$merge\": {\n      \"into\": \"mge-course-statistic\",\n      \"whenMatched\": \"merge\",\n      \"whenNotMatched\": \"insert\"\n    }\n  }"
        }
      ],
      "locale": null,
      "locale_id": null,
      "created_at": "2025-05-13T15:13:26.000Z",
      "created_by": "6711e8a47b45b2974bd6133c",
      "updated_at": "2025-05-26T11:32:58.000Z",
      "updated_by": "6711e8a47b45b2974bd6133c",
      "tenant_id": "677f6b3da3131eb0d3f9906d",
      "id": "6822ff2687dcae27865d2756"
    }
  },
  {
    "_id": "68809e09b9966a21a10d4620",
    "title": "create log like tweet - 674028d2611a654e763a73e8",
    "cron_expression": "*/1 * * * *",
    "is_active": true,
    "data": {
      "_id": "68809e09b9966a21a10d4620",
      "title": "create log like tweet",
      "type": [
        "classic"
      ],
      "timeout": "*/1 * * * *",
      "flow": null,
      "arrgregate": "[\n  {\n    \"$match\": {\n      \"is_waiting_like\": true\n    }\n  },\n  {\n    \"$addFields\": {\n      \"social_group\": {\n        \"$map\": {\n          \"input\": \"$social_group\",\n          \"as\": \"sg\",\n          \"in\": {\n            \"$toObjectId\": \"$$sg\"\n          }\n        }\n      }\n    }\n  },\n  {\n    \"$lookup\": {\n      \"from\": \"mge-group\",\n      \"localField\": \"social_group\",\n      \"foreignField\": \"_id\",\n      \"as\": \"social_group\"\n    }\n  },\n  {\n    \"$addFields\": {\n      \"social_group\": {\n        \"$arrayElemAt\": [\"$social_group\", 0]\n      }\n    }\n  },\n  {\n    \"$addFields\": {\n      \"created_by\": {\n        \"$toObjectId\": \"$created_by\"\n      }\n    }\n  },\n  {\n    \"$lookup\": {\n      \"from\": \"user\",\n      \"localField\": \"created_by\",\n      \"foreignField\": \"_id\",\n      \"as\": \"created_by\"\n    }\n  },\n  {\n    \"$addFields\": {\n      \"created_by\": {\n        \"$arrayElemAt\": [\"$created_by\", 0]\n      }\n    }\n  }\n]\n",
      "collection_name": "mge-entity-like",
      "setup": [
        {
          "merge": "[\n  {\n    \"$addFields\": {\n      \"activity_log\": {\n        \"title\": \" Bạn đã thích bài viết của $user_full_name trong $social_group_title\",\n        \"value_replace\": [\n          {\n            \"title\": \"user_full_name\",\n            \"value\": \"$created_by.full_name\"\n          },\n          {\n            \"title\": \"social_group_title\",\n            \"value\": \"$social_group.title\"\n          },\n          {\n            \"title\": \"tweet_id\",\n            \"value\": \"$entity_id\"\n          },\n          {\n            \"title\": \"social_group\",\n            \"value\": \"$social_group._id\"\n          }\n        ],\n        \"parent_type\": \"tweet_engagement\",\n        \"type\": \"TWEET_LIKED\",\n        \"from\": [\n          {\n            \"$toString\": \"$created_by._id\"\n          }\n        ],\n        \"like_document\": \"$_id\"\n      }\n    }\n  },\n  {\n    \"$replaceRoot\": {\n      \"newRoot\": \"$activity_log\"\n    }\n  },\n  {\n    \"$merge\": {\n      \"into\": \"mge-social-activity-log-record\",\n      \"whenMatched\": \"replace\",\n      \"whenNotMatched\": \"insert\"\n    }\n  }\n]\n"
        },
        {
          "merge": "[\n  {\n    \"$addFields\": {\n      \"is_waiting_like\": false\n    }\n  },\n  {\n    \"$project\": {\n       \"is_waiting_like\": 1\n    }\n  },\n  {\n    \"$merge\": {\n      \"into\": \"mge-entity-like\",\n      \"whenMatched\": \"merge\",\n      \"whenNotMatched\": \"discard\"\n    }\n  }\n]\n"
        }
      ],
      "locale": null,
      "locale_id": null,
      "created_at": "2025-07-23T15:32:09.000Z",
      "created_by": "6711e8a47b45b2974bd6133c",
      "updated_at": "2025-07-23T15:46:37.000Z",
      "updated_by": "6711e8a47b45b2974bd6133c",
      "tenant_id": "674028d2611a654e763a73e8",
      "watcher": ""
    }
  },
  {
    "_id": "6880a903edb2b79b9531be9a",
    "title": "remove log like tweet - 674028d2611a654e763a73e8",
    "cron_expression": "*/1 * * * *",
    "is_active": true,
    "data": {
      "_id": "6880a903edb2b79b9531be9a",
      "title": "remove log like tweet",
      "type": [
        "classic"
      ],
      "timeout": "*/1 * * * *",
      "flow": null,
      "arrgregate": "[\n  {\n    \"$match\": {\n      \"is_waiting_unlike\": true\n    }\n  }\n]\n",
      "collection_name": "mge-entity-like",
      "setup": [
        {
          "merge": "[\n  {\n    \"$lookup\": {\n      \"from\": \"mge-social-activity-log-record\",\n      \"localField\": \"_id\",\n      \"foreignField\": \"like_document\",\n      \"as\": \"check\"\n    }\n  },\n  {\n    \"$addFields\": {\n      \"check\": {\n        \"$arrayElemAt\": [\"$check\", 0]\n      }\n    }\n  },\n  {\n    \"$match\": {\n      \"check\": { \"$ne\": null }\n    }\n  },\n  {\n    \"$replaceRoot\": {\n      \"newRoot\": \"$check\"\n    }\n  },\n  {\n    \"$project\": {\n      \"_id\": 1\n    }\n  },\n  {\n    \"$merge\": {\n      \"into\": \"mge-social-activity-log-record\",\n      \"whenMatched\": \"replace\"\n    }\n  }\n]\n"
        },
        {
          "merge": "[\n  {\n    \"$replaceRoot\": {\n      \"newRoot\": {\n        \"_id\": \"$_id\"\n      }\n    }\n  },\n  {\n    \"$merge\": {\n      \"into\": \"mge-entity-like\",\n      \"whenMatched\": \"replace\"\n    }\n  }\n]\n"
        }
      ],
      "locale": null,
      "locale_id": null,
      "created_at": "2025-07-23T16:18:59.000Z",
      "created_by": "6711e8a47b45b2974bd6133c",
      "updated_at": "2025-07-24T11:03:53.000Z",
      "updated_by": "6711e8a47b45b2974bd6133c",
      "tenant_id": "674028d2611a654e763a73e8",
      "watcher": ""
    }
  }
]