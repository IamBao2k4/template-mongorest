{
  "_id": "67ee024e8660ad558d91ef7a",
  "title": "Get list group joined example",
  "note": "",
  "cache_time": "",
  "method": "get-list",
  "outputEntity": [
    "6747ef07c47463d88f8c5ab1"
  ],
  "queryAdvance": "[\r\n  {\r\n    \"$addFields\": {\r\n      \"_id\": {\r\n        \"$toString\": \"$_id\"\r\n      }\r\n    }\r\n  },\r\n  {\r\n    \"$match\": {\r\n      \"tenant_id\": \"@header:x-tenant-id\"\r\n    }\r\n  },\r\n  {\r\n    \"$lookup\": {\r\n      \"from\": \"mge-group-member\",\r\n      \"localField\": \"_id\",\r\n      \"foreignField\": \"social_group\",\r\n      \"pipeline\": [\r\n        {\r\n          \"$match\": {\r\n            \"status\": \"joined\"\r\n          }\r\n        }\r\n      ],\r\n      \"as\": \"group_members\"\r\n    }\r\n  },\r\n  {\r\n    \"$addFields\": {\r\n      \"member_count\": {\r\n        \"$size\": \"$group_members\"\r\n      }\r\n    }\r\n  },\r\n  {\r\n    \"$lookup\": {\r\n      \"from\": \"mge-group-member\",\r\n      \"localField\": \"_id\",\r\n      \"foreignField\": \"social_group\",\r\n      \"pipeline\": [\r\n        {\r\n          \"$match\": {\r\n            \"$expr\": {\r\n              \"$and\": [\r\n                {\r\n                  \"$in\": [\r\n                    \"@jwt:user.id\",\r\n                    \"$user\"\r\n                  ]\r\n                },\r\n                {\r\n                  \"$eq\": [\r\n                    \"$status\",\r\n                    [\r\n                      \"joined\"\r\n                    ]\r\n                  ]\r\n                }\r\n              ]\r\n            }\r\n          }\r\n        }\r\n      ],\r\n      \"as\": \"memberStatus\"\r\n    }\r\n  },\r\n  {\r\n    \"$match\": {\r\n      \"memberStatus\": {\r\n        \"$ne\": []\r\n      }\r\n    }\r\n  },\r\n  {\r\n    \"$project\": {\r\n      \"group_members\": 0\r\n    }\r\n  },\r\n  {\r\n    \"$lookup\": {\r\n      \"from\": \"media\",\r\n      \"let\": {\r\n        \"featuredImageId\": {\r\n          \"$arrayElemAt\": [\r\n            \"$cover\",\r\n            0\r\n          ]\r\n        }\r\n      },\r\n      \"pipeline\": [\r\n        {\r\n          \"$match\": {\r\n            \"$expr\": {\r\n              \"$eq\": [\r\n                \"$_id\",\r\n                {\r\n                  \"$toObjectId\": \"$$featuredImageId\"\r\n                }\r\n              ]\r\n            }\r\n          }\r\n        },\r\n        {\r\n          \"$addFields\": {\r\n            \"path\": {\r\n              \"$concat\": [\r\n                {\r\n                  \"$cond\": [\r\n                    {\r\n                      \"$eq\": [\r\n                        \"minio\",\r\n                        \"@app_settings:storage_type\"\r\n                      ]\r\n                    },\r\n                    \"@app_settings:minio.public\",\r\n                    \"@app_settings:doSpace.public\"\r\n                  ]\r\n                },\r\n                \"/\",\r\n                \"$disk\",\r\n                \"/\",\r\n                \"$filename\"\r\n              ]\r\n            }\r\n          }\r\n        }\r\n      ],\r\n      \"as\": \"cover\"\r\n    }\r\n  },\r\n  {\r\n    \"$match\": {\r\n      \"$expr\": {\r\n        \"$or\": [\r\n          {\r\n            \"$eq\": [\r\n              \"@param:title\",\r\n              null\r\n            ]\r\n          },\r\n          {\r\n            \"$regexMatch\": {\r\n              \"input\": \"$title\",\r\n              \"regex\": \"@param:title\",\r\n              \"options\": \"i\"\r\n            }\r\n          }\r\n        ]\r\n      },\r\n      \"status\": \"active\"\r\n    }\r\n  },\r\n  {\r\n    \"$sort\": {\r\n      \"member_count\": -1\r\n    }\r\n  },\r\n  {\r\n    \"$facet\": {\r\n      \"meta_data\": [\r\n        {\r\n          \"$count\": \"count\"\r\n        },\r\n        {\r\n          \"$addFields\": {\r\n            \"skip\": \"@param:skip\",\r\n            \"limit\": \"@param:limit\"\r\n          }\r\n        }\r\n      ],\r\n      \"data\": [\r\n        {\r\n          \"$skip\": \"@param:skip\"\r\n        },\r\n        {\r\n          \"$limit\": \"@param:limit\"\r\n        }\r\n      ]\r\n    }\r\n  }\r\n]",
  "categories": [],
  "tenant_id": "674028d2611a654e763a73e8"
}