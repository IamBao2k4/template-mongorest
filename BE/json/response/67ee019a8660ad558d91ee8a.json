{
  "_id": "67ee019a8660ad558d91ee8a",
  "title": "Get detail tweet example",
  "note": "nhập mô tả cho response ở đây",
  "cache_time": "",
  "method": "get-detail",
  "outputEntity": [
    "67b6a286606da18e6c1976f1"
  ],
  "queryAdvance": "[\r\n  {\r\n    \"$addFields\": {\r\n      \"tweet_id\": {\r\n        \"$toString\": \"$_id\"\r\n      }\r\n    }\r\n  },\r\n  {\r\n    \"$match\": {\r\n      \"$or\": [\r\n        {\r\n          \"slug\": \"@param:slug\"\r\n        },\r\n        {\r\n          \"tweet_id\": \"@param:tweet_id\"\r\n        },\r\n        {\r\n          \"tweet_id\": \"@param:_id\"\r\n        }\r\n      ]\r\n    }\r\n  },\r\n  {\r\n    \"$addFields\": {\r\n      \"tag\": {\r\n        \"$map\": {\r\n          \"input\": \"$tag\",\r\n          \"as\": \"u\",\r\n          \"in\": {\r\n            \"$toObjectId\": \"$$u\"\r\n          }\r\n        }\r\n      }\r\n    }\r\n  },\r\n  {\r\n    \"$lookup\": {\r\n      \"from\": \"mge-social-tag\",\r\n      \"localField\": \"tag\",\r\n      \"foreignField\": \"_id\",\r\n      \"as\": \"tag\"\r\n    }\r\n  },\r\n  {\r\n    \"$lookup\": {\r\n      \"from\": \"user-tenant-profile\",\r\n      \"localField\": \"created_by\",\r\n      \"foreignField\": \"user\",\r\n      \"pipeline\": [\r\n        {\r\n          \"$match\": {\r\n            \"tenant_id\": \"@header:x-tenant-id\"\r\n          }\r\n        },\r\n        {\r\n          \"$addFields\": {\r\n            \"full_name\": {\r\n              \"$concat\": [\r\n                \"$profile.social.last_name\",\r\n                \" \",\r\n                \"$profile.social.first_name\"\r\n              ]\r\n            }\r\n          }\r\n        },\r\n        {\r\n          \"$project\": {\r\n            \"_id\": \"$user\",\r\n            \"full_name\": 1,\r\n            \"featured_image\": \"$profile.social.featured_image\"\r\n          }\r\n        }\r\n      ],\r\n      \"as\": \"user\"\r\n    }\r\n  },\r\n  {\r\n    \"$addFields\": {\r\n      \"groupObject\": {\r\n        \"$map\": {\r\n          \"input\": \"$social_group\",\r\n          \"as\": \"u\",\r\n          \"in\": {\r\n            \"$toObjectId\": \"$$u\"\r\n          }\r\n        }\r\n      }\r\n    }\r\n  },\r\n  {\r\n    \"$lookup\": {\r\n      \"from\": \"mge-group\",\r\n      \"localField\": \"groupObject\",\r\n      \"foreignField\": \"_id\",\r\n      \"as\": \"group\"\r\n    }\r\n  },\r\n  {\r\n    \"$addFields\": {\r\n      \"categories\": {\r\n        \"$map\": {\r\n          \"input\": \"$categories\",\r\n          \"as\": \"u\",\r\n          \"in\": {\r\n            \"$toObjectId\": \"$$u\"\r\n          }\r\n        }\r\n      }\r\n    }\r\n  },\r\n  {\r\n    \"$lookup\": {\r\n      \"from\": \"mge-group-category\",\r\n      \"localField\": \"categories\",\r\n      \"foreignField\": \"_id\",\r\n      \"as\": \"categories\"\r\n    }\r\n  },\r\n  {\r\n    \"$lookup\": {\r\n      \"from\": \"mge-group-member\",\r\n      \"localField\": \"social_group\",\r\n      \"foreignField\": \"social_group\",\r\n      \"pipeline\": [\r\n        {\r\n          \"$match\": {\r\n            \"user\": \"@jwt:user.id\",\r\n            \"tenant_id\": \"@header:x-tenant-id\"\r\n          }\r\n        }\r\n      ],\r\n      \"as\": \"member_status\"\r\n    }\r\n  },\r\n  {\r\n    \"$addFields\": {\r\n      \"joined\": {\r\n        \"$cond\": {\r\n          \"if\": {\r\n            \"$or\": [\r\n              {\r\n                \"$eq\": [\r\n                  \"$member_status.status\",\r\n                  [\r\n                    \"joined\"\r\n                  ]\r\n                ]\r\n              },\r\n              {\r\n                \"$eq\": [\r\n                  \"$member_status.status\",\r\n                  [\r\n                    [\r\n                      \"joined\"\r\n                    ]\r\n                  ]\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": true,\r\n          \"else\": false\r\n        }\r\n      }\r\n    }\r\n  },\r\n  {\r\n    \"$lookup\": {\r\n      \"from\": \"mge-entity-like\",\r\n      \"let\": {\r\n        \"currentId\": \"$tweet_id\",\r\n        \"userId\": \"@jwt:user.id\"\r\n      },\r\n      \"pipeline\": [\r\n        {\r\n          \"$match\": {\r\n            \"$expr\": {\r\n              \"$and\": [\r\n                {\r\n                  \"$eq\": [\r\n                    \"$entity_id\",\r\n                    \"$$currentId\"\r\n                  ]\r\n                },\r\n                {\r\n                  \"$eq\": [\r\n                    \"$created_by\",\r\n                    \"$$userId\"\r\n                  ]\r\n                }\r\n              ]\r\n            }\r\n          }\r\n        }\r\n      ],\r\n      \"as\": \"liked_info\"\r\n    }\r\n  },\r\n  {\r\n    \"$addFields\": {\r\n      \"liked\": {\r\n        \"$cond\": {\r\n          \"if\": {\r\n            \"$gt\": [\r\n              {\r\n                \"$size\": \"$liked_info\"\r\n              },\r\n              0\r\n            ]\r\n          },\r\n          \"then\": true,\r\n          \"else\": false\r\n        }\r\n      }\r\n    }\r\n  },\r\n  {\r\n    \"$lookup\": {\r\n      \"from\": \"mge-entity-like\",\r\n      \"localField\": \"tweet_id\",\r\n      \"foreignField\": \"entity_id\",\r\n      \"as\": \"liked_details\"\r\n    }\r\n  },\r\n  {\r\n    \"$addFields\": {\r\n      \"like_count\": {\r\n        \"$size\": \"$liked_details\"\r\n      }\r\n    }\r\n  },\r\n  {\r\n    \"$lookup\": {\r\n      \"from\": \"mge-tweet-saved\",\r\n      \"let\": {\r\n        \"currentId\": \"$tweet_id\",\r\n        \"userId\": \"@jwt:user.id\"\r\n      },\r\n      \"pipeline\": [\r\n        {\r\n          \"$match\": {\r\n            \"$expr\": {\r\n              \"$and\": [\r\n                {\r\n                  \"$eq\": [\r\n                    \"$tweet_id\",\r\n                    \"$$currentId\"\r\n                  ]\r\n                },\r\n                {\r\n                  \"$eq\": [\r\n                    \"$created_by\",\r\n                    \"$$userId\"\r\n                  ]\r\n                }\r\n              ]\r\n            }\r\n          }\r\n        }\r\n      ],\r\n      \"as\": \"saved_info\"\r\n    }\r\n  },\r\n  {\r\n    \"$addFields\": {\r\n      \"saved\": {\r\n        \"$cond\": {\r\n          \"if\": {\r\n            \"$gt\": [\r\n              {\r\n                \"$size\": \"$saved_info\"\r\n              },\r\n              0\r\n            ]\r\n          },\r\n          \"then\": true,\r\n          \"else\": false\r\n        }\r\n      }\r\n    }\r\n  },\r\n  {\r\n    \"$lookup\": {\r\n      \"from\": \"mge-tweet-comment\",\r\n      \"localField\": \"tweet_id\",\r\n      \"foreignField\": \"tweet\",\r\n      \"as\": \"comment\"\r\n    }\r\n  },\r\n  {\r\n    \"$addFields\": {\r\n      \"comment_count\": {\r\n        \"$size\": \"$comment\"\r\n      }\r\n    }\r\n  },\r\n  {\r\n    \"$lookup\": {\r\n      \"from\": \"media\",\r\n      \"let\": {\r\n        \"featuredImageId\": {\r\n          \"$arrayElemAt\": [\r\n            \"$featured_image\",\r\n            0\r\n          ]\r\n        }\r\n      },\r\n      \"pipeline\": [\r\n        {\r\n          \"$match\": {\r\n            \"$expr\": {\r\n              \"$eq\": [\r\n                \"$_id\",\r\n                {\r\n                  \"$toObjectId\": \"$$featuredImageId\"\r\n                }\r\n              ]\r\n            }\r\n          }\r\n        },\r\n        {\r\n          \"$addFields\": {\r\n            \"path\": {\r\n              \"$concat\": [\r\n                {\r\n                  \"$cond\": [\r\n                    {\r\n                      \"$eq\": [\r\n                        \"minio\",\r\n                        \"@app_settings:storage_type\"\r\n                      ]\r\n                    },\r\n                    \"@app_settings:minio.public\",\r\n                    \"@app_settings:doSpace.public\"\r\n                  ]\r\n                },\r\n                \"/\",\r\n                \"$disk\",\r\n                \"/\",\r\n                \"$filename\"\r\n              ]\r\n            }\r\n          }\r\n        }\r\n      ],\r\n      \"as\": \"featured_image\"\r\n    }\r\n  },\r\n  {\r\n    \"$project\": {\r\n      \"comment\": 0\r\n    }\r\n  },\r\n  {\r\n    \"$lookup\": {\r\n      \"from\": \"mge-user-vote-result\",\r\n      \"localField\": \"tweet_id\",\r\n      \"foreignField\": \"tweet_id\",\r\n      \"pipeline\": [\r\n        {\r\n          \"$lookup\": {\r\n            \"from\": \"user-tenant-profile\",\r\n            \"localField\": \"created_by\",\r\n            \"foreignField\": \"user\",\r\n            \"pipeline\": [\r\n              {\r\n                \"$match\": {\r\n                  \"tenant_id\": \"@header:x-tenant-id\"\r\n                }\r\n              },\r\n              {\r\n                \"$addFields\": {\r\n                  \"full_name\": {\r\n                    \"$concat\": [\r\n                      \"$profile.social.last_name\",\r\n                      \" \",\r\n                      \"$profile.social.first_name\"\r\n                    ]\r\n                  }\r\n                }\r\n              },\r\n              {\r\n                \"$project\": {\r\n                  \"_id\": \"$user\",\r\n                  \"full_name\": 1,\r\n                  \"featured_image\": \"$profile.social.featured_image\"\r\n                }\r\n              }\r\n            ],\r\n            \"as\": \"user\"\r\n          }\r\n        }\r\n      ],\r\n      \"as\": \"vote_info\"\r\n    }\r\n  },\r\n  {\r\n    \"$addFields\": {\r\n      \"total_user_voted\": {\r\n        \"$size\": \"$vote_info\"\r\n      }\r\n    }\r\n  },\r\n  {\r\n    \"$addFields\": {\r\n      \"vote_info\": {\r\n        \"$map\": {\r\n          \"input\": \"$vote_info\",\r\n          \"as\": \"vote\",\r\n          \"in\": {\r\n            \"$mergeObjects\": [\r\n              \"$$vote\",\r\n              {\r\n                \"_id\": {\r\n                  \"$toString\": \"$$vote._id\"\r\n                }\r\n              }\r\n            ]\r\n          }\r\n        }\r\n      }\r\n    }\r\n  },\r\n  {\r\n    \"$addFields\": {\r\n      \"vote_info\": {\r\n        \"$cond\": {\r\n          \"if\": {\r\n            \"$eq\": [\r\n              \"$type\",\r\n              \"votes\"\r\n            ]\r\n          },\r\n          \"then\": \"$vote_info\",\r\n          \"else\": \"$$REMOVE\"\r\n        }\r\n      },\r\n      \"total_user_voted\": {\r\n        \"$cond\": {\r\n          \"if\": {\r\n            \"$eq\": [\r\n              \"$type\",\r\n              \"votes\"\r\n            ]\r\n          },\r\n          \"then\": \"$total_user_voted\",\r\n          \"else\": \"$$REMOVE\"\r\n        }\r\n      },\r\n      \"answers\": {\r\n        \"$cond\": {\r\n          \"if\": {\r\n            \"$eq\": [\r\n              \"$type\",\r\n              \"votes\"\r\n            ]\r\n          },\r\n          \"then\": \"$answers\",\r\n          \"else\": \"$$REMOVE\"\r\n        }\r\n      }\r\n    }\r\n  },\r\n  {\r\n    \"$facet\": {\r\n      \"meta_data\": [\r\n        {\r\n          \"$count\": \"count\"\r\n        },\r\n        {\r\n          \"$addFields\": {\r\n            \"skip\": \"@param:skip\",\r\n            \"limit\": \"@param:limit\"\r\n          }\r\n        }\r\n      ],\r\n      \"data\": [\r\n        {\r\n          \"$skip\": \"@param:skip\"\r\n        },\r\n        {\r\n          \"$limit\": \"@param:limit\"\r\n        }\r\n      ]\r\n    }\r\n  }\r\n]",
  "categories": [],
  "tenant_id": "674028d2611a654e763a73e8"
}