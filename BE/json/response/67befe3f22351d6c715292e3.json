{
  "_id": "67befe3f22351d6c715292e3",
  "title": "search social tweet group ",
  "note": "",
  "cache_time": "",
  "method": "get-list",
  "outputEntity": [
    "67b6a286606da18e6c1976f1"
  ],
  "categories": [],
  "tenant_id": "674028d2611a654e763a73e8",
  "documents": [],
  "queryAdvance": "[\r\n  {\r\n    \"$match\": {\r\n      \"title\": {\r\n        \"$regex\": \"@param:search\",\r\n        \"$options\": \"i\"\r\n      }\r\n    }\r\n  },\r\n  {\r\n    \"$addFields\": {\r\n      \"collection_name\": \"mge-tweet\"\r\n    }\r\n  },\r\n  {\r\n    \"$lookup\": {\r\n      \"from\": \"mge-group\",\r\n      \"let\": {\r\n        \"social_group_ids\": {\r\n          \"$map\": {\r\n            \"input\": \"$social_group\",\r\n            \"as\": \"sg\",\r\n            \"in\": {\r\n              \"$toObjectId\": \"$$sg\"\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"pipeline\": [\r\n        {\r\n          \"$match\": {\r\n            \"$expr\": {\r\n              \"$in\": [\r\n                \"$_id\",\r\n                \"$$social_group_ids\"\r\n              ]\r\n            }\r\n          }\r\n        },\r\n        {\r\n          \"$addFields\": {\r\n            \"id\": {\r\n              \"$toString\": \"$_id\"\r\n            }\r\n          }\r\n        },\r\n        {\r\n          \"$lookup\": {\r\n            \"from\": \"mge-group-member\",\r\n            \"localField\": \"id\",\r\n            \"foreignField\": \"social_group\",\r\n            \"as\": \"group_members\",\r\n            \"pipeline\": [\r\n              {\r\n                \"$match\": {\r\n                  \"user\": \"@jwt:user.id\"\r\n                }\r\n              },\r\n              {\r\n                \"$set\": {\r\n                  \"user\": {\r\n                    \"$map\": {\r\n                      \"input\": \"$user\",\r\n                      \"as\": \"u\",\r\n                      \"in\": {\r\n                        \"$toObjectId\": \"$$u\"\r\n                      }\r\n                    }\r\n                  }\r\n                }\r\n              },\r\n              {\r\n                \"$lookup\": {\r\n                  \"from\": \"user\",\r\n                  \"localField\": \"user\",\r\n                  \"foreignField\": \"_id\",\r\n                  \"as\": \"user\"\r\n                }\r\n              },\r\n              {\r\n                \"$unwind\": \"$user\"\r\n              },\r\n              {\r\n                \"$set\": {\r\n                  \"user.featured_image\": {\r\n                    \"$map\": {\r\n                      \"input\": \"$user.featured_image\",\r\n                      \"as\": \"img\",\r\n                      \"in\": {\r\n                        \"$toObjectId\": \"$$img\"\r\n                      }\r\n                    }\r\n                  }\r\n                }\r\n              },\r\n              {\r\n                \"$lookup\": {\r\n                  \"from\": \"media\",\r\n                  \"localField\": \"user.featured_image\",\r\n                  \"foreignField\": \"_id\",\r\n                  \"as\": \"user.media_info\"\r\n                }\r\n              },\r\n              {\r\n                \"$addFields\": {\r\n                  \"user.media_info\": {\r\n                    \"$arrayElemAt\": [\r\n                      \"$user.media_info\",\r\n                      0\r\n                    ]\r\n                  }\r\n                }\r\n              },\r\n              {\r\n                \"$addFields\": {\r\n                  \"user.featured_image\": {\r\n                    \"$cond\": {\r\n                      \"if\": {\r\n                        \"$gt\": [\r\n                          {\r\n                            \"$size\": \"$user.featured_image\"\r\n                          },\r\n                          0\r\n                        ]\r\n                      },\r\n                      \"then\": {\r\n                        \"_id\": {\r\n                          \"$arrayElemAt\": [\r\n                            \"$user.featured_image\",\r\n                            0\r\n                          ]\r\n                        },\r\n                        \"filename\": \"$user.media_info.filename\",\r\n                        \"path\": {\r\n                          \"$concat\": [\r\n                            {\r\n                              \"$cond\": [\r\n                                {\r\n                                  \"$eq\": [\r\n                                    \"minio\",\r\n                                    \"@app_settings:storage_type\"\r\n                                  ]\r\n                                },\r\n                                \"@app_settings:minio.public\",\r\n                                \"@app_settings:doSpace.public\"\r\n                              ]\r\n                            },\r\n                            \"/\",\r\n                            \"$user.media_info.disk\",\r\n                            \"/\",\r\n                            \"$user.media_info.filename\"\r\n                          ]\r\n                        }\r\n                      },\r\n                      \"else\": null\r\n                    }\r\n                  }\r\n                }\r\n              },\r\n              {\r\n                \"$project\": {\r\n                  \"_id\": 1,\r\n                  \"social_group\": 1,\r\n                  \"status\": 1,\r\n                  \"role\": 1,\r\n                  \"locale\": 1,\r\n                  \"created_at\": 1,\r\n                  \"created_by\": 1,\r\n                  \"updated_at\": 1,\r\n                  \"updated_by\": 1,\r\n                  \"tenant_id\": 1,\r\n                  \"isFollow\": 1,\r\n                  \"user._id\": 1,\r\n                  \"user.email\": 1,\r\n                  \"user.username\": 1,\r\n                  \"user.full_name\": 1,\r\n                  \"user.featured_image\": 1\r\n                }\r\n              }\r\n            ]\r\n          }\r\n        },\r\n        {\r\n          \"$match\": {\r\n            \"$expr\": {\r\n              \"$or\": [\r\n                {\r\n                  \"$eq\": [\r\n                    {\r\n                      \"$size\": \"$group_members\"\r\n                    },\r\n                    1\r\n                  ]\r\n                },\r\n                {\r\n                  \"$eq\": [\r\n                    \"$type\",\r\n                    \"public\"\r\n                  ]\r\n                }\r\n              ]\r\n            }\r\n          }\r\n        },\r\n        {\r\n          \"$addFields\": {\r\n            \"collection_name\": \"mge-group\"\r\n          }\r\n        }\r\n      ],\r\n      \"as\": \"group_info\"\r\n    }\r\n  },\r\n  {\r\n    \"$unionWith\": {\r\n      \"coll\": \"mge-group\",\r\n      \"pipeline\": [\r\n        {\r\n          \"$match\": {\r\n            \"title\": {\r\n              \"$regex\": \"@param:search\",\r\n              \"$options\": \"i\"\r\n            }\r\n          }\r\n        },\r\n        {\r\n          \"$addFields\": {\r\n            \"id\": {\r\n              \"$toString\": \"$_id\"\r\n            }\r\n          }\r\n        },\r\n        {\r\n          \"$lookup\": {\r\n            \"from\": \"mge-group-member\",\r\n            \"localField\": \"id\",\r\n            \"foreignField\": \"social_group\",\r\n            \"as\": \"group_members\",\r\n            \"pipeline\": [\r\n              {\r\n                \"$match\": {\r\n                  \"user\": \"@jwt:user.id\"\r\n                }\r\n              },\r\n              {\r\n                \"$set\": {\r\n                  \"user\": {\r\n                    \"$toObjectId\": \"$user\"\r\n                  }\r\n                }\r\n              },\r\n              {\r\n                \"$lookup\": {\r\n                  \"from\": \"user\",\r\n                  \"localField\": \"user\",\r\n                  \"foreignField\": \"_id\",\r\n                  \"as\": \"user\"\r\n                }\r\n              },\r\n              {\r\n                \"$unwind\": \"$user\"\r\n              },\r\n              {\r\n                \"$set\": {\r\n                  \"user.featured_image\": {\r\n                    \"$map\": {\r\n                      \"input\": \"$user.featured_image\",\r\n                      \"as\": \"img\",\r\n                      \"in\": {\r\n                        \"$toObjectId\": \"$$img\"\r\n                      }\r\n                    }\r\n                  }\r\n                }\r\n              },\r\n              {\r\n                \"$lookup\": {\r\n                  \"from\": \"media\",\r\n                  \"localField\": \"user.featured_image\",\r\n                  \"foreignField\": \"_id\",\r\n                  \"as\": \"user.media_info\"\r\n                }\r\n              },\r\n              {\r\n                \"$addFields\": {\r\n                  \"user.media_info\": {\r\n                    \"$arrayElemAt\": [\r\n                      \"$user.media_info\",\r\n                      0\r\n                    ]\r\n                  }\r\n                }\r\n              },\r\n              {\r\n                \"$addFields\": {\r\n                  \"user.featured_image\": {\r\n                    \"$cond\": {\r\n                      \"if\": {\r\n                        \"$gt\": [\r\n                          {\r\n                            \"$size\": \"$user.featured_image\"\r\n                          },\r\n                          0\r\n                        ]\r\n                      },\r\n                      \"then\": {\r\n                        \"_id\": {\r\n                          \"$arrayElemAt\": [\r\n                            \"$user.featured_image\",\r\n                            0\r\n                          ]\r\n                        },\r\n                        \"filename\": \"$user.media_info.filename\",\r\n                        \"path\": {\r\n                          \"$concat\": [\r\n                            {\r\n                              \"$cond\": [\r\n                                {\r\n                                  \"$eq\": [\r\n                                    \"minio\",\r\n                                    \"@app_settings:storage_type\"\r\n                                  ]\r\n                                },\r\n                                \"@app_settings:minio.public\",\r\n                                \"@app_settings:doSpace.public\"\r\n                              ]\r\n                            },\r\n                            \"/\",\r\n                            \"$user.media_info.disk\",\r\n                            \"/\",\r\n                            \"$user.media_info.filename\"\r\n                          ]\r\n                        }\r\n                      },\r\n                      \"else\": null\r\n                    }\r\n                  }\r\n                }\r\n              },\r\n              {\r\n                \"$project\": {\r\n                  \"_id\": 1,\r\n                  \"social_group\": 1,\r\n                  \"status\": 1,\r\n                  \"role\": 1,\r\n                  \"locale\": 1,\r\n                  \"created_at\": 1,\r\n                  \"created_by\": 1,\r\n                  \"updated_at\": 1,\r\n                  \"updated_by\": 1,\r\n                  \"tenant_id\": 1,\r\n                  \"isFollow\": 1,\r\n                  \"user._id\": 1,\r\n                  \"user.email\": 1,\r\n                  \"user.username\": 1,\r\n                  \"user.full_name\": 1,\r\n                  \"user.featured_image\": 1\r\n                }\r\n              }\r\n            ]\r\n          }\r\n        },\r\n        {\r\n          \"$match\": {\r\n            \"$expr\": {\r\n              \"$or\": [\r\n                {\r\n                  \"$eq\": [\r\n                    {\r\n                      \"$size\": \"$group_members\"\r\n                    },\r\n                    1\r\n                  ]\r\n                },\r\n                {\r\n                  \"$eq\": [\r\n                    \"$type\",\r\n                    \"public\"\r\n                  ]\r\n                }\r\n              ]\r\n            }\r\n          }\r\n        },\r\n        {\r\n          \"$addFields\": {\r\n            \"collection_name\": \"mge-group\"\r\n          }\r\n        }\r\n      ]\r\n    }\r\n  },\r\n  {\r\n    \"$facet\": {\r\n      \"meta_data\": [\r\n        {\r\n          \"$count\": \"count\"\r\n        },\r\n        {\r\n          \"$addFields\": {\r\n            \"skip\": \"@param:skip\",\r\n            \"limit\": \"@param:limit\"\r\n          }\r\n        }\r\n      ],\r\n      \"data\": [\r\n        {\r\n          \"$skip\": \"@param:skip\"\r\n        },\r\n        {\r\n          \"$limit\": \"@param:limit\"\r\n        }\r\n      ]\r\n    }\r\n  }\r\n]",
  "params": [
    {
      "value": "search",
      "key": "search"
    },
    {
      "value": "skip",
      "key": "skip"
    },
    {
      "value": "limit",
      "key": "limit"
    }
  ]
}